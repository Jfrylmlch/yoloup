yoloup
------------
yoloup is a simple commandline utility to update yolo annotation files based on a new class file.

### Why should I use yoloup?
Many offline labelling softwares do not provide a way to save your annotation projects in between. Every time you start a new session to label a new set of images, the class index will start from 0 rather than your last class index + 1. That means, a new class file will be generated, which has no relationship with your last class file. For example, "elephant" indexed at 0 in your last class file might end up indexed at 5 in your current class file if "elephant" is the sixth class you encounter rather than the first class. This problem becomes critical when the labelling work is distributed to several people as everyone has their own class file. yoloup allows you to update multiple yolo annotation files all at once based on a new class file so a unified dataset can be developed.

### Usage
```
Usage: yoloup [OPTIONS] [orginal_class_file] [updated_class_file] [yolo_annotation_file ...]
  -h	Print help information
  -i	Request confirmation before attempting to update each file
  -n	Print updated yolo annotation file to stdout
```
### Examples
In the following examples, it is assumed that "target.txt", "labels.txt" are under your current location. The yolo annotation files starting with a prefix "RCNX" are put in different subdirectores where each directory has one txt class file with a name containing the string "label". You should be able to easily modify the commands to adapt to your needs. But make sure the command is correct or it might ruin all of your labelling work.

Let's say there is a yolo annotation file "RCNX0001.txt"
```
0 0.449951 0.490972 0.232910 0.276389
1 0.348754 0.402843 0.252323 0.306251
```
, and the original class file "labels.txt"
```
elephant
lion
horse
```
Suppose you now have an updated class file "target.txt", which includes more classes than labels.txt but the order is messed up. For example, elephant is move from index 0 to index 2.
```
donkey
tiger
elephant
dog
cat
lion
horse
```
And you want to use a new set of indices based on a new class file "target.txt" instead of "labels.txt" to include more classes, you can do the following:
```
yoloup ./labels.txt ./target.txt ./RCNX0001.txt
```
This will transform RCNX0001.txt into:
```
2 0.449951 0.490972 0.232910 0.276389
5 0.348754 0.402843 0.252323 0.306251
```
You can update multiple yolo annotation files by
```
yoloup ./labels.txt ./target.txt ./RCNX0001.txt ./RCNX0002.txt ./RCNX0003.txt
```
or even process all yolo annotation files in subdirectories recursively. 
```
find . -iregex '.*label.*\.txt$' -exec sh -c 'yoloup "{}" ./target.txt "$(dirname {})"/RCNX*.txt' \;
```

### Extra Tips
You might wonder where the "target.txt" came from at the very beginning. Usually annotation files are organized in different directories where each directory has its own labels.txt. In this case, the "target.txt" can be easily generated by running this Bash command under the parent directory of those directories. 
```
awk '{gsub(/^[ \t]+|[ \t]+$/, ""); print $0}'  **/*labels* | sort | uniq > target.txt
```
This command would gather the classes in all labels.txt in the directories, filter out the duplicates, and save the result to target.txt.







